const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/index.browser.esm-CZsAH7yY.js","assets/index-BrTV8evZ.js","assets/index-BU5HMy9F.css"])))=>i.map(i=>d[i]);
import{r as i,j as e,t as R,B as x,q as B,c as N,d as _,o as z,b as Q,_ as V,e as q,s as L,A as oe,f as re,C as ne,D as ie,h as ce,F as le,i as de,k as me,l as pe,G as ue,Q as he,m as xe,n as fe,p as be,u as ye,v as ve,w as we,S as ge,T as je,V as _e,x as Ne,y as Pe,z as Ce,E as De,H as Se,I as Ee,J as Fe,K as ke,L as Te,M as Ie,N as Ae,O as Re,P as Ve,R as Be,U as ze,W as Qe,X as qe,Y as Le,Z as Oe}from"./index-BrTV8evZ.js";const Ue=Object.freeze(Object.defineProperty({__proto__:null,AbstractUserDataWriter:oe,Bytes:re,CollectionReference:ne,DocumentReference:ie,DocumentSnapshot:ce,FieldPath:le,FieldValue:de,Firestore:me,FirestoreError:pe,GeoPoint:ue,Query:he,QueryCompositeFilterConstraint:xe,QueryConstraint:fe,QueryDocumentSnapshot:be,QueryFieldFilterConstraint:ye,QueryOrderByConstraint:ve,QuerySnapshot:we,SnapshotMetadata:ge,Timestamp:je,VectorValue:_e,_AutoId:Ne,_ByteString:Pe,_DatabaseId:Ce,_DocumentKey:De,_EmptyAuthCredentialsProvider:Se,_FieldPath:Ee,_cast:Fe,_logWarn:ke,_validateIsNotUsedTogether:Te,addDoc:q,arrayUnion:Ie,collection:N,connectFirestoreEmulator:Ae,doc:Re,ensureFirestoreConfigured:Ve,executeWrite:Be,getDoc:ze,getDocs:Q,getFirestore:Qe,increment:qe,orderBy:z,query:B,serverTimestamp:L,setDoc:Le,updateDoc:Oe},Symbol.toStringTag,{value:"Module"})),Ge=({setCurrentPage:Ke,language:O,showMessage:n,t:U})=>{const K=e.jsx("div",{className:"mb-4 text-xs text-[#66fcf1] font-semibold text-center",children:"Red: Solana"}),t=U||R[O]||R.es,[b,P]=i.useState([]),[W,C]=i.useState(!0),[p,D]=i.useState(!1),[r,S]=i.useState(""),[y,E]=i.useState(!1),[F,c]=i.useState(""),[$,k]=i.useState(!1),[m,T]=i.useState({title:"",description:""}),[v,I]=i.useState(!1),G=async()=>{if(c(""),!window.solana||!window.solana.isPhantom){window.open("https://phantom.app/download","_blank"),c(t["phantom-not-found"]);return}try{const s=await window.solana.connect({onlyIfTrusted:!1});D(!0),S(s.publicKey.toString())}catch{c(t["phantom-connect-error"])}},H=async()=>{if(window.solana&&window.solana.isPhantom)try{await window.solana.disconnect()}catch{}D(!1),S(""),E(!1)},J=async()=>{if(c(""),!p||!r){c(t["presale-connect-required"]);return}try{const{solana:s}=window;if(!s||!s.isPhantom)throw new Error("Phantom no está disponible");const a=await V(()=>import("./index.browser.esm-CZsAH7yY.js"),__vite__mapDeps([0,1,2])),o=new a.Connection("https://mainnet.helius-rpc.com/?api-key=b4aa694f-00a7-49e2-8e19-83e793d508c1"),l=new a.PublicKey("3qxa32hbFKMTAesrtUBykqRcNnzGpix3F3QHQR5JcPBT"),f=new a.PublicKey(r),g=Math.floor(.001*1e9),u=new a.Transaction().add(a.SystemProgram.transfer({fromPubkey:f,toPubkey:l,lamports:g}));u.feePayer=f;const{blockhash:j}=await o.getLatestBlockhash();u.recentBlockhash=j;const h=await s.signTransaction(u);await o.sendRawTransaction(h.serialize()),E(!0),c("")}catch(s){c((t["commission-error"]||"Error al pagar la comisión: ")+(s.message||""))}},A=s=>{const{name:a,value:o}=s.target;T(l=>({...l,[a]:o}))},Y=async s=>{if(s.preventDefault(),!p||!r){c(t["presale-connect-required"]);return}if(!y){c("Debes pagar la comisión de 0.001 SOL para crear una propuesta.");return}if(!m.title.trim()||!m.description.trim()){n&&n(t["proposal-form-title-desc-empty"]||t["proposal-form-page-subtitle"],"error");return}I(!0);try{await q(N(_,"dao_proposals"),{title:m.title,description:m.description,votes:0,voters:[],creator:r,created:L()}),n&&n(t["proposal-creation-success"]||t["proposal-creation-success"],"success"),T({title:"",description:""}),k(!1),w()}catch(a){const o=t["proposal-creation-error"]||"Error creating proposal:";n&&n(`${o} ${a.message}`,"error")}finally{I(!1)}},X=async s=>{if(!r)return;const a=b[s];if(!(!a||a.votes>=50||a.voters&&a.voters.includes(r)))try{const{doc:o,updateDoc:l,arrayUnion:f,increment:g,getDoc:u,setDoc:j}=await V(async()=>{const{doc:Z,updateDoc:M,arrayUnion:ee,increment:te,getDoc:se,setDoc:ae}=await Promise.resolve().then(()=>Ue);return{doc:Z,updateDoc:M,arrayUnion:ee,increment:te,getDoc:se,setDoc:ae}},void 0),h=o(_,"dao_proposals",a.id);let d=(await u(h)).data();if(!d){n&&n("No se encontró la propuesta en la base de datos.","error");return}if(d&&d.voters&&d.voters.includes(r))return;typeof d.votes!="number"&&(await j(h,{votes:0,...d},{merge:!0}),d.votes=0),await l(h,{votes:g(1),voters:f(r)}),await w()}catch(o){n&&n("Error al votar: "+(o.message||o),"error")}},w=async()=>{C(!0);try{const s=B(N(_,"dao_proposals"),z("created","desc")),o=(await Q(s)).docs.map(l=>({id:l.id,...l.data()}));P(o)}catch{P([])}C(!1)};return i.useEffect(()=>{w()},[]),e.jsxs(e.Fragment,{children:[K,e.jsxs("section",{className:"space-y-8",children:[e.jsxs("div",{className:"text-center narrow",children:[e.jsx("div",{className:"section-header"}),e.jsx("h1",{className:"fluid-h2 font-bold gradient-text mb-4",children:t["dao-page-title"]}),e.jsx("p",{className:"fluid-subtitle text-gray-400 text-content mb-8",children:t["dao-page-subtitle"]})]}),e.jsx("div",{className:"w-full flex justify-center",children:e.jsx("h2",{className:"text-2xl font-bold text-white mb-2 text-center",children:t["dao-active-proposals-title"]})}),e.jsxs("div",{className:"section text-center narrow",children:[p?e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"text-xs text-[#66fcf1] font-mono mb-2",children:[t["phantom-connected"],": ",r.slice(0,7),"...",r.slice(-7)]}),e.jsx("button",{onClick:H,className:"mt-1 px-3 py-1 text-xs rounded bg-red-600 text-white hover:bg-red-700 transition font-bold shadow",children:t.disconnect||"Desconectar"})]}):e.jsx(x,{onClick:G,size:"lg",className:"w-fit",children:t.connect_phantom||"Conectar Phantom"}),p&&!y&&e.jsx(x,{onClick:J,size:"md",className:"w-fit bg-yellow-400 text-[#0b0c10] hover:bg-yellow-500 mt-2",children:t["pay-commission"]||"Pagar comisión 0.001 SOL"}),F&&e.jsx("div",{className:"bg-red-700/80 text-white text-sm text-center mt-2 px-4 py-2 rounded-xl shadow border border-red-400 animate-pulse w-fit mx-auto",children:F}),e.jsx(x,{onClick:()=>k(!0),variant:"outline",disabled:!p||!y,children:t["dao-btn-create-proposal"]}),$&&e.jsxs("form",{onSubmit:Y,className:"space-y-6 w-full max-w-xl mx-auto mt-4",children:[e.jsxs("div",{children:[e.jsx("label",{htmlFor:"title",className:"block text-left text-white font-bold mb-2",children:t["proposal-form-title-label"]}),e.jsx("input",{type:"text",id:"title",name:"title",value:m.title,onChange:A,required:!0,className:"input",placeholder:t["proposal-form-title-placeholder"]||t["proposal-form-title-label"],disabled:v})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"description",className:"block text-left text-white font-bold mb-2",children:t["proposal-form-desc-label"]}),e.jsx("textarea",{id:"description",name:"description",value:m.description,onChange:A,rows:"6",required:!0,className:"textarea",placeholder:t["proposal-form-desc-placeholder"]||t["proposal-form-desc-label"],disabled:v})]}),e.jsx(x,{type:"submit",size:"lg",className:"w-full",loading:v,children:t["proposal-form-btn-submit"]})]})]}),e.jsx("div",{className:"section narrow",children:e.jsx("div",{className:"card p-6 md:p-8",children:e.jsx("div",{className:"flex flex-col items-center",children:W?e.jsxs("div",{className:"flex flex-col items-center text-gray-400",children:[e.jsxs("svg",{className:"w-10 h-10 animate-spin text-[#66fcf1]",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",children:[e.jsx("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),e.jsx("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]}),e.jsx("span",{className:"mt-2 text-sm",children:t["dao-loading-proposals"]})]}):b.length===0?e.jsx("p",{className:"text-gray-500 text-content",children:t["dao-no-proposals"]}):e.jsx("div",{className:"w-full space-y-4",children:b.map((s,a)=>e.jsxs("div",{className:"card p-6 mb-4",children:[e.jsxs("div",{className:"flex justify-between items-center mb-2",children:[e.jsx("h3",{className:"text-2xl font-bold text-white",children:s.title}),e.jsx(x,{size:"sm",onClick:()=>X(a),disabled:s.votes>=50||s.voters&&s.voters.includes(r),className:"ml-4",children:s.voters&&s.voters.includes(r)?t["dao-proposal-status-voted"]||"Ya votaste":t["dao-proposal-btn-vote"]||"Votar"})]}),e.jsx("p",{className:"text-gray-400 mb-4 truncate",children:s.description}),e.jsxs("div",{className:"flex justify-between items-center text-sm text-gray-500 mb-2",children:[e.jsxs("span",{children:[t["dao-proposal-status"]," ",e.jsx("span",{className:"text-green-400",children:t["dao-proposal-status-active"]})]}),e.jsxs("span",{children:[t["dao-proposal-votes"]," ",e.jsx("span",{className:"text-[#66fcf1] font-bold",children:s.votes||0})," de 50"]})]}),e.jsx("div",{className:"w-full h-2 bg-[#2c2f33] rounded-full overflow-hidden",children:e.jsx("div",{className:"h-full bg-[#66fcf1] transition-all duration-500 ease-out",style:{width:`${(s.votes||0)/50*100}%`}})})]},a))})})})})]})]})};export{Ge as default};
